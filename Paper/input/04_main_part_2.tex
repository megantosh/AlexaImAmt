\chapter{Skill Implementation}%: \inote{Kosten-/Terminabfrage}}
\label{maintwo}

\section{Setup}


\todo{codechunks different labeling??
}


step by step code analysis

\url{https://github.com/alexa/alexa-skills-kit-sdk-for-nodejs/blob/master/Readme.md}
\subsection{requirements}

for audio

json format https://stackoverflow.com/questions/41776014/how-to-correctly-specify-ssml-in-an-alexa-skill-lambda-function



HTTP(S) endpoint:
\url{http://newsreel-edu.aot.tu-berlin.de/solr/#/d115}


references:

\url{https://developer.amazon.com/docs/custom-skills/speech-synthesis-markup-language-ssml-reference.html#audio}



blogs:
\url{https://developer.amazon.com/post/Tx3FXYSTHS579WO/Announcing-New-Alexa-Skills-Kit-ASK-Features-SSML-Audio-Tags-and-Developer-Porta}

With the JSON we have, we try to maximise its use, but we need to consider that with starting a Skill, it is better to start from scratch sometimes and as we go, we see what is the relevant information that we can integrate into our Skill.

We analyze the output of Virtueller B체rgerassistent and realize it makes less sense to start with that, so we refer to the underlying endpoint. Since this is the Solr Server that delivers JSON objects and is more realistic to maneuver, we analyse the queries we can get from there. and try to fit it into our interaction model.

Then we move on to the interaction model. On paper, we draft the use-cases to determine what are our intents first to group these into fewer intents than the services we have. Given that there are many public services related to a similar case, we design our Skill to make it possible to group them into less intents. The advantage of this is that it allows us to at least have fewer 'ServiceIntents' than the ever growing number of services, which means that we want to also be able to track new services as they get inserted into the catalogue to be able to either map them to old intents by extending these, or to introduce new intents if this does not work.



\todo{ moved from intro\\


our now more than \inote{4}
scenarios:
\begin{itemize}
	\item a general scenario of predefined categories related to any service \tocite{hier schon erw채hnen? \inote{(prerequisites, costs, documents, ...)}}
	\item special application on \textbf{Residence Registration} - ``Anmeldung einer Wohnung''
	\item special application on \textbf{Applying for a Residence Permit} - mutliple services related to ``Aufenthaltstitel''
	\item ``car registration'' -  special application on \textbf{Car Registration''} - multiple services  related to ``Kraftfahrzeug (KFZ)''
	%	\item[scenario 4] \inote{yet to be decided or if to implement}
\end{itemize}}

%%%%%%%%%%%%%%%



\todo{moved from AWS Microservices list\\

	We might as well use just our own, any other privately or cloud-based server solution to host our code and use it as an endpoint for our software, however choosing Lambda takes away the overhead of linking the front-end with the back-end of the Skill %program we develop (an Alexa Skill as we describe below). 

}

%%%%%%%%%%%






\section{step-by-step}

start with interaction model
then use builder
then fulfill functions


steps to git commit
deploy
clone
change in browser
change offline


if u use a browser, remember to keep the session active otherwise your model might get lost in the POST

\section{Code Analysis}

from \url{https://github.com/alexa/alexa-skills-kit-sdk-for-nodejs/blob/master/Readme.md}
The difference between :ask/listen and :tell/speak is that after a :tell/speak action, the session is ended without waiting for the user to provide more input. We will compare the two ways using response or using responseBuilder to create the response object in next section.




jsons sent/received in appendix
\ref{jsonFromAlexa}




problems with countrylist
 cote d'ivoir, s체dsee (british territories overseas, ...)


legal things like the EU-partner rule.
eu rules override local
bas u cant explain it to people 3ashan they have to be give the choice.
el mawdou3 mo3aqqad but codified here
\url{https://eur-lex.europa.eu/legal-content/EN/TXT/?uri=CELEX:02004L0038-20110616}














\section{Deployment}

\section{Approval and Publishing}
	Continuous Skill Approval is the process of Amazon deciding whether each uploaded version / update is still fit for purpose, make the skill better or worse in conjunction with other skills on the Store % or change things to worse partly
	
	\todo{mention that 3ashan homa store w keda fal mawdou3 lazem yekoun mo7kam w 7agat homa bey7ebouha and the reasons why things could get rejected according to their policy and some scenarios}

\section{Debugging / Troubleshooting}

\section{Documentation Updates}
https://www.gitbook.com/join/tu-berlin/-LAZYgGmoeaEZGb8cYg2
https://tu-berlin.gitbook.io/alexa/

% Implementation as Facebook Messenger Bot / Google Action
\textcolor{magenta}{
- as an example for text\\
- implementing the answer suggestions as buttons\\
- passing data to the B체rgeramt terminseite\\
https://console.dialogflow.com/api-client/ \\
https://console.actions.google.com
}


%Solr is not secure (ein kleines thing in future work)
Solr has to be secure
\url{https://docs.aws.amazon.com/AmazonS3/latest/dev/WebsiteEndpoints.html#WebsiteRestEndpointDiff}


Hey:

do this set up as prerequisites first
as a deployment script

- install aws cli
- install ask cli
- set up a profile on AWS
- ask init etc.

https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-getting-started.html

There is no AWS credential setup yet, do you want to continue the initialization?

https://developer.amazon.com/docs/smapi/quick-start-alexa-skills-kit-command-line-interface.html



Manage IAM roles (User, groups, rights, policies etc.)


all logs go onto cloudwatch
including when the request is not right etc...can be helpful to know what users want, beyond testing





amazon does not disclose avaliable values for their slot types (lists), but they give you examples here
%https://developer.amazon.com/docs/custom-skills/slot-type-reference.html#h2_extend_types


===

finally, we had to resolve to the information publicly available to tailor custom scenarios



 ===
once you upload the new lambda, the old one is gone, unless you version it like this:
https://docs.aws.amazon.com/lambda/latest/dg/versioning-aliases.html



====

first i got screwed over with this Big nerd ranch then this happened: alexa-skill module
- so don't use this tutorial, although very helpful for a beginner and makes you understand what happens under the hood, it has been abstracted in many other function and the logic is no longer the same. - which explains why no one starred it

https://github.com/matt-kruse/alexa-app

https://www.bignerdranch.com/blog/developing-alexa-skills-locally-with-nodejs-deploying-your-skill-to-staging/



\todo{
	OnLaunch\\
	IntentHandler\\
	intent is triggered by utterence\\
	account verlinkungen etc\\
}

Prob with outdated tutorials

\todo{
eventually mention here: \\
as we mentioned Amazon's strong take on constant changes, we will go over the workarounds and circumventions to retain a working version of the Skill we present, discuss the downside of adaptability to these changes \inote{(constantly basastem nafsi 3ala 7aga gedida)}
}